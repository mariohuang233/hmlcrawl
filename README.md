# å®¶åº­ç”¨ç”µç›‘æ§ä¸å¯è§†åŒ–ç³»ç»Ÿ

ä¸€ä¸ªåŸºäºNode.js + Reactçš„å®¶åº­ç”¨ç”µç›‘æ§ç³»ç»Ÿï¼Œæ”¯æŒè‡ªåŠ¨æ•°æ®é‡‡é›†ã€å­˜å‚¨å’Œå¯è§†åŒ–å±•ç¤ºã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ”„ **è‡ªåŠ¨é‡‡é›†**: æ¯10åˆ†é’Ÿè‡ªåŠ¨ä»ç”µåŠ›ç½‘ç«™æŠ“å–ç”µè¡¨æ•°æ®
- ğŸ“Š **æ•°æ®å­˜å‚¨**: ä½¿ç”¨MongoDBå­˜å‚¨å†å²ç”¨ç”µæ•°æ®ï¼Œæ”¯æŒç´¢å¼•ä¼˜åŒ–
- ğŸ“ˆ **å¯è§†åŒ–**: Reactå‰ç«¯å±•ç¤ºç”¨ç”µè¶‹åŠ¿å’Œç»Ÿè®¡å›¾è¡¨
- ğŸ¯ **æ™ºèƒ½é¢„æµ‹**: å¤šçª—å£ç®—æ³•é¢„æµ‹ç”µé‡è€—å°½æ—¶é—´ï¼ˆçŸ­æœŸ/ä¸­æœŸ/é•¿æœŸåˆ†æï¼‰
- ğŸ“‰ **å¯¹æ¯”åˆ†æ**: æ”¯æŒä»Šæ—¥vsæ˜¨æ—¥ã€æœ¬å‘¨vsä¸Šå‘¨ã€æœ¬æœˆvsä¸Šæœˆå¯¹æ¯”
- âš¡ **æ€§èƒ½ä¼˜åŒ–**: å†…å­˜ç¼“å­˜æœºåˆ¶ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢
- ğŸš€ **ä¸€é”®éƒ¨ç½²**: æ”¯æŒRailwayå’ŒZeaburå¹³å°éƒ¨ç½²
- ğŸ“± **å“åº”å¼**: æ”¯æŒç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯è®¿é—®ï¼Œé€‚é…æš—å¤œæ¨¡å¼
- ğŸ›¡ï¸ **å¥å£®æ€§**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæ£€æŸ¥

## æŠ€æœ¯æ ˆ

### åç«¯
- Node.js + Express
- MongoDB + Mongoose
- å®šæ—¶ä»»åŠ¡ (node-cron)
- ç½‘é¡µçˆ¬è™« (axios + cheerio)
- æ—¥å¿—ç³»ç»Ÿ (winston)

### å‰ç«¯
- React + TypeScript
- ECharts å›¾è¡¨åº“
- TailwindCSS æ ·å¼æ¡†æ¶
- Axios HTTPå®¢æˆ·ç«¯

## é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ crawler/          # çˆ¬è™«æ¨¡å—
â”‚   â”œâ”€â”€ api/             # APIæ¥å£
â”‚   â”œâ”€â”€ models/          # æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ utils/           # å·¥å…·å‡½æ•°
â”œâ”€â”€ frontend/            # Reactå‰ç«¯
â”œâ”€â”€ logs/               # æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ server.js           # æœåŠ¡å™¨å…¥å£
â””â”€â”€ package.json
```

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
# å®‰è£…åç«¯ä¾èµ–
npm install

# å®‰è£…å‰ç«¯ä¾èµ–
cd frontend && npm install
```

### 2. ç¯å¢ƒé…ç½®

å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿ï¼š
```bash
cp env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œé…ç½®MongoDBè¿æ¥å­—ç¬¦ä¸²ï¼š
```
MONGO_URI=mongodb+srv://username:password@cluster.mongodb.net/database
PORT=3000
```

### 3. æ„å»ºå‰ç«¯

```bash
cd frontend && npm run build
```

### 4. å¯åŠ¨æœåŠ¡

```bash
npm start
```

è®¿é—® http://localhost:3000 æŸ¥çœ‹åº”ç”¨ã€‚

## éƒ¨ç½²æŒ‡å—

### Railway éƒ¨ç½²

1. è¿æ¥GitHubä»“åº“åˆ°Railway
2. é…ç½®ç¯å¢ƒå˜é‡ï¼š
   - `MONGO_URI`: MongoDBè¿æ¥å­—ç¬¦ä¸²
   - `PORT`: ç«¯å£å·ï¼ˆRailwayä¼šè‡ªåŠ¨åˆ†é…ï¼‰
3. éƒ¨ç½²å®Œæˆåï¼ŒRailwayä¼šè‡ªåŠ¨å¯åŠ¨æœåŠ¡

#### æœ¬åœ°çˆ¬è™« + Railway æœåŠ¡

å¦‚æœä½ å¸Œæœ›åœ¨æœ¬åœ°ç”µè„‘è¿›è¡Œçˆ¬å–ï¼Œå¹¶æŠŠæ•°æ®å†™å…¥åŒä¸€ä¸ª MongoDBï¼ŒåŒæ—¶æŠŠ Web/API éƒ¨ç½²åˆ° Railwayï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤ï¼š

- åœ¨ Railway ç¯å¢ƒå˜é‡ä¸­è®¾ç½®ï¼š`ENABLE_CRAWLER=false`ï¼Œè®©çº¿ä¸Šå®ä¾‹ä¸è‡ªåŠ¨å¯åŠ¨çˆ¬è™«ã€‚
- åœ¨æœ¬åœ°åˆ›å»º `.env.local`ï¼ˆæˆ–ç›´æ¥ä½¿ç”¨ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼‰å¹¶é…ç½®ï¼š
  - `MONGO_URI` æŒ‡å‘ä¸ Railway ç›¸åŒçš„æ•°æ®åº“
  - å¯é€‰ï¼š`USE_DIRECT_IP=true`ï¼ˆå»ºè®®ç›´è¿ï¼Œä¸èµ° localtunnelï¼‰
  - å¯é€‰ï¼š`PROXY_URL=http://localhost:3000`ï¼ˆå¦‚ä½¿ç”¨æœ¬åœ°ä»£ç†ï¼‰
- æœ¬åœ°å¯åŠ¨çˆ¬è™«ï¼š
  ```bash
  npm run crawler:local
  ```
- éªŒè¯æ•°æ®ï¼šè®¿é—® Railway çš„ `/api/latest`ï¼Œåº”èƒ½çœ‹åˆ°æ•°æ®éšç€æœ¬åœ°çˆ¬è™«å‘¨æœŸæ€§æ›´æ–°ã€‚

#### ä¸€é”®è¿è¡Œï¼ˆæœ¬åœ°ï¼‰

- é»˜è®¤ç›´è¿æ¨¡å¼ï¼ˆæ¨èï¼Œé¿å… localtunnel 405ï¼‰ï¼š
  ```bash
  npm run oneclick
  ```
- ä»£ç†æ¨¡å¼ï¼ˆéœ€è¦å…¬ç½‘å…¥å£æ—¶ä½¿ç”¨ï¼‰ï¼š
  ```bash
  ONECLICK_MODE=proxy npm run oneclick
  ```
- å¯é€‰ï¼šæŒ‡å®šæœ¬åœ°ç¯å¢ƒæ–‡ä»¶è·¯å¾„
  ```bash
  LOCAL_ENV_PATH=.env.local npm run oneclick
  ```

è¯´æ˜ï¼šä»£ç†æ¨¡å¼ä¼šå¯åŠ¨æœ¬åœ°ä»£ç†å¹¶å°è¯• LocalTunnel æš´éœ²å…¬ç½‘åœ°å€ï¼Œå¤±è´¥æ—¶ä¼šæç¤ºä½¿ç”¨ `ngrok http 3000`ã€‚Railway å¦‚éœ€èµ°å…¬ç½‘å…¥å£ï¼Œå¯å°† `PROXY_URL` é…ç½®ä¸ºè„šæœ¬è¾“å‡ºçš„å…¬ç½‘åœ°å€ã€‚

### Zeabur éƒ¨ç½²

é¡¹ç›®å·²åŒ…å«å®Œæ•´çš„Zeaburé…ç½®æ–‡ä»¶ï¼š

1. **è¿æ¥GitHubä»“åº“**åˆ°Zeabur
2. **é…ç½®ç¯å¢ƒå˜é‡**ï¼š
   ```bash
   PORT=3000
   NODE_ENV=production
   MONGO_URI=mongodb+srv://username:password@host/electricity
   ```
3. **Zeaburä¼šè‡ªåŠ¨è¯†åˆ«**ï¼š
   - âœ… Dockerfileè¿›è¡Œå®¹å™¨åŒ–æ„å»º
   - âœ… ç«¯å£3000è‡ªåŠ¨æš´éœ²
   - âœ… å¥åº·æ£€æŸ¥ `/health` ç«¯ç‚¹
4. **å¯é€‰ï¼šå…³é—­è‡ªåŠ¨ä¼‘çœ **
   - Settings â†’ Auto Sleep â†’ Disable
   - é€‚åˆéœ€è¦7Ã—24å°æ—¶è¿è¡Œçš„æœåŠ¡

è¯¦ç»†æ•…éšœæ’æŸ¥è¯·æŸ¥çœ‹ [ZEABUR_FIX.md](./ZEABUR_FIX.md)

## APIæ¥å£

### æ€»è§ˆæ•°æ®
```
GET /api/overview
```
è¿”å›å½“å‰å‰©ä½™ç”µé‡ã€ä»Šæ—¥/æœ¬å‘¨/æœ¬æœˆç”¨ç”µã€è´¹ç”¨é¢„ä¼°ã€æ™ºèƒ½é¢„æµ‹ã€å¯¹æ¯”æ•°æ®ç­‰

### 24å°æ—¶è¶‹åŠ¿
```
GET /api/trend/24h
```
è¿”å›è¿‡å»24å°æ—¶çš„ç”¨ç”µè¶‹åŠ¿

### å½“å¤©ç”¨ç”µï¼ˆæŒ‰å°æ—¶ï¼‰
```
GET /api/trend/today
```
è¿”å›ä»Šæ—¥æ¯å°æ—¶ç”¨ç”µé‡ï¼ŒåŒ…å«ä¸æ˜¨æ—¥åŒæ—¶æ®µå¯¹æ¯”

### 30å¤©è¶‹åŠ¿
```
GET /api/trend/30d
```
è¿”å›æœ€è¿‘30å¤©æ¯æ—¥ç”¨ç”µé‡ï¼ŒåŒ…å«ä¸å‰ä¸€å¤©å¯¹æ¯”

### æœˆåº¦è¶‹åŠ¿
```
GET /api/trend/monthly
```
è¿”å›æœ€è¿‘12ä¸ªæœˆçš„ç”¨ç”µé‡ï¼ŒåŒ…å«ä¸ä¸Šæœˆå¯¹æ¯”

### æœ€æ–°æ•°æ®
```
GET /api/latest
```
è·å–æœ€æ–°é‡‡é›†çš„ç”µè¡¨æ•°æ®

### æ‰‹åŠ¨è§¦å‘çˆ¬å–
```
POST /api/crawl
```
æ‰‹åŠ¨è§¦å‘ä¸€æ¬¡æ•°æ®é‡‡é›†

## æ ¸å¿ƒç®—æ³•

### æ™ºèƒ½é¢„æµ‹ç®—æ³•
é‡‡ç”¨å¤šçª—å£åˆ†ææ³•é¢„æµ‹ç”µé‡è€—å°½æ—¶é—´ï¼š
- **çŸ­æœŸçª—å£ï¼ˆ6å°æ—¶ï¼‰**: æ•æ‰æœ€æ–°ç”¨ç”µè¶‹åŠ¿ï¼Œæƒé‡50%
- **ä¸­æœŸçª—å£ï¼ˆ24å°æ—¶ï¼‰**: åˆ†ææ—¥å¸¸ç”¨ç”µè§„å¾‹ï¼Œæƒé‡30%
- **é•¿æœŸçª—å£ï¼ˆ7å¤©åŒæ—¶æ®µï¼‰**: è€ƒè™‘å‘¨æœŸæ€§ç”¨ç”µæ¨¡å¼ï¼Œæƒé‡20%

åŠ¨æ€æƒé‡è°ƒæ•´ï¼š
- çŸ­æœŸç”¨ç”µé‡æ¿€å¢æ—¶ï¼Œè‡ªåŠ¨å¢åŠ çŸ­æœŸæƒé‡
- æ£€æµ‹å……å€¼è¡Œä¸ºï¼Œè‡ªåŠ¨è¿‡æ»¤å¼‚å¸¸æ•°æ®ç‚¹

### æ€§èƒ½ä¼˜åŒ–
- **æ•°æ®åº“ç´¢å¼•**: å¤åˆç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
- **å†…å­˜ç¼“å­˜**: 2-10åˆ†é’Ÿç¼“å­˜ï¼Œå‡å°‘é‡å¤æŸ¥è¯¢
- **å¹¶è¡ŒæŸ¥è¯¢**: Promise.allå¹¶è¡Œæ‰§è¡Œå¤šä¸ªç»Ÿè®¡æŸ¥è¯¢
- **æ‡’åŠ è½½**: å›¾è¡¨ç»„ä»¶é‡‡ç”¨æ‡’æ›´æ–°ç­–ç•¥

## æ•°æ®æ¨¡å‹

### Usage é›†åˆ
```javascript
{
  meter_id: String,        // ç”µè¡¨ID
  meter_name: String,      // ç”µè¡¨åç§°
  remaining_kwh: Number,    // å‰©ä½™ç”µé‡(kWh)
  collected_at: Date       // é‡‡é›†æ—¶é—´
}
```

## çˆ¬è™«é…ç½®

ç³»ç»Ÿä¼šè‡ªåŠ¨ä»æŒ‡å®šURLæŠ“å–ç”µè¡¨æ•°æ®ã€‚å¦‚éœ€ä¿®æ”¹çˆ¬å–ç›®æ ‡ï¼Œè¯·ç¼–è¾‘ `src/crawler/crawler.js` æ–‡ä»¶ä¸­çš„URLå’Œè§£æé€»è¾‘ã€‚

## æ—¥å¿—ç³»ç»Ÿ

- åº”ç”¨æ—¥å¿—: `logs/app.log`
- é”™è¯¯æ—¥å¿—: `logs/error.log`
- çˆ¬è™«æ—¥å¿—: `logs/fetch-YYYYMMDD.log`

## å¼€å‘è¯´æ˜

### æœ¬åœ°å¼€å‘

```bash
# å¯åŠ¨åç«¯ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
npm run dev

# å¯åŠ¨å‰ç«¯ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
cd frontend && npm start
```

### æµ‹è¯•çˆ¬è™«

```bash
# æ‰‹åŠ¨è§¦å‘çˆ¬å–
curl -X POST http://localhost:3000/api/crawl
```

## æ•…éšœæ’é™¤

1. **MongoDBè¿æ¥å¤±è´¥**: æ£€æŸ¥è¿æ¥å­—ç¬¦ä¸²å’Œç½‘ç»œè®¿é—®æƒé™
2. **çˆ¬è™«å¤±è´¥**: æ£€æŸ¥ç›®æ ‡ç½‘ç«™æ˜¯å¦å¯è®¿é—®ï¼Œå¯èƒ½éœ€è¦è°ƒæ•´User-Agent
3. **å‰ç«¯æ„å»ºå¤±è´¥**: ç¡®ä¿Node.jsç‰ˆæœ¬ >= 18.0.0

## è®¸å¯è¯

MIT License
