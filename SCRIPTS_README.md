# 雷神电量监控 - 一键启动脚本

## 脚本说明

本项目提供了一套完整的一键启动脚本，确保电脑重启后爬虫自动运行。

## 脚本列表

### 1. `startup.bat` - 开机自启动（推荐）
**用途**: 将此脚本添加到 Windows 启动文件夹，实现开机自动启动

**功能**:
- 自动检测服务是否已运行（避免重复启动）
- 自动启动 PM2 爬虫
- 自动启动 Web 服务器
- 5秒后自动关闭窗口

**如何设置开机自启动**:
1. 按 `Win + R` 打开运行对话框
2. 输入 `shell:startup` 并回车
3. 将 `startup.bat` 的快捷方式复制到打开的文件夹
4. 重启电脑验证

### 2. `start-all.bat` - 手动启动所有服务
**用途**: 手动启动爬虫和服务器

**功能**:
- 检查服务是否已运行
- 启动 PM2 爬虫（如未运行）
- 启动 Web 服务器
- 显示访问地址

### 3. `stop-all.bat` - 停止所有服务
**用途**: 停止所有运行中的服务

**功能**:
- 停止 PM2 爬虫
- 停止 Web 服务器

### 4. `logs.bat` - 查看日志
**用途**: 查看各种日志文件

**功能**:
- 查看今天爬虫日志
- 查看昨天爬虫日志
- 查看应用日志
- 查看错误日志
- 查看PM2日志
- 实时监控爬虫日志

## 服务说明

### PM2 爬虫
- **定时**: 每15分钟执行一次
- **随机延迟**: 0-5分钟（避免被检测）
- **数据保存**: 自动保存到 MongoDB
- **日志**: 保存到 `logs/fetch-YYYYMMDD.log`

### Web 服务器
- **端口**: 3000
- **健康检查**: http://localhost:3000/health
- **前端**: http://localhost:3000
- **API**: http://localhost:3000/api

## 常见问题

### Q: 电脑重启后爬虫没有运行？
**A**: 使用 `startup.bat` 设置开机自启动

### Q: 如何查看爬虫是否正常工作？
**A**:
1. 运行 `logs.bat` 选择"实时监控爬虫日志"
2. 访问 http://localhost:3000/health 检查服务状态
3. 查看 MongoDB 数据确认数据更新

### Q: 爬虫多久执行一次？
**A**: 每15分钟执行一次，带有0-5分钟的随机延迟

### Q: 如何手动触发爬取？
**A**: 访问 http://localhost:3000/api/crawler/trigger

### Q: 如何停止所有服务？
**A**: 运行 `stop-all.bat`

## 日志文件说明

- `fetch-YYYYMMDD.log` - 爬虫日志（按天归档）
- `app.log` - 应用主日志
- `error.log` - 错误日志
- `pm2-out.log` - PM2 输出日志
- `pm2-error.log` - PM2 错误日志

## 技术支持

- **Node.js**: v18+
- **PM2**: 进程管理器
- **MongoDB**: 数据存储
- **Express**: Web 框架

## 更新日志

### 2026-01-17
- 创建一键启动脚本系统
- 优化爬虫启动逻辑（立即执行一次）
- 添加开机自启动支持
- 添加日志查看工具
