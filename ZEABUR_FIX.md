# Zeabur NotTriggerScaleUp å½»åº•è§£å†³æ–¹æ¡ˆ

## ğŸ¯ é—®é¢˜æ ¹æº

`NotTriggerScaleUp` é”™è¯¯è¡¨ç¤ºZeaburçš„è‡ªåŠ¨ä¼¸ç¼©ç³»ç»Ÿæ— æ³•è¯†åˆ«æˆ–å¯åŠ¨ä½ çš„æœåŠ¡ã€‚

### æ ¸å¿ƒåŸå› åˆ†æ

1. **ç«¯å£è¯†åˆ«é—®é¢˜** âŒ
   - æœåŠ¡ç›‘å¬ `localhost` è€Œé `0.0.0.0`
   - æœªæ˜ç¡®æš´éœ²ç«¯å£å·

2. **å¥åº·æ£€æŸ¥å¤±è´¥** âŒ
   - æ¢é’ˆæ— æ³•è®¿é—®å¥åº·æ£€æŸ¥ç«¯ç‚¹
   - å¯åŠ¨æ—¶é—´è¿‡é•¿å¯¼è‡´è¶…æ—¶

3. **å®¹å™¨é…ç½®ä¸å®Œæ•´** âŒ
   - ç¼ºå°‘Dockerfileæ˜ç¡®é…ç½®
   - å¯åŠ¨å‘½ä»¤ä¸æ¸…æ™°

## âœ… å·²å®æ–½çš„å®Œæ•´è§£å†³æ–¹æ¡ˆ

### 1. æœåŠ¡å™¨é…ç½®ä¼˜åŒ–

```javascript
// server.js - å…³é”®ä¿®æ”¹

// âœ… ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£ï¼ˆå®¹å™¨ç¯å¢ƒå¿…éœ€ï¼‰
const server = app.listen(PORT, '0.0.0.0', () => {
  logger.info(`æœåŠ¡å™¨å·²å¯åŠ¨åœ¨ç«¯å£ ${PORT}`);
  logger.info(`ç¯å¢ƒ: ${process.env.NODE_ENV || 'development'}`);
});

// âœ… å¤šä¸ªå¥åº·æ£€æŸ¥ç«¯ç‚¹
app.get('/health', (req, res) => {
  res.status(200).json({ status: 'ok', ... });
});

app.get('/ping', (req, res) => {
  res.status(200).send('pong');
});
```

### 2. Dockerfileé…ç½®ï¼ˆæ ¸å¿ƒï¼‰

```dockerfile
FROM node:18-alpine

WORKDIR /app

# å®‰è£…ä¾èµ–
COPY package*.json ./
RUN npm ci --only=production

# æ„å»ºå‰ç«¯
COPY frontend/package*.json ./frontend/
RUN cd frontend && npm ci
COPY . .
RUN npm run build

# âœ… æ˜ç¡®æš´éœ²ç«¯å£ï¼ˆè®©Zeaburè¯†åˆ«ï¼‰
EXPOSE 3000

# âœ… å¥åº·æ£€æŸ¥é…ç½®
HEALTHCHECK --interval=30s --timeout=10s --start-period=40s --retries=3 \
  CMD node -e "require('http').get('http://localhost:3000/health', ...)"

# âœ… å¯åŠ¨å‘½ä»¤
CMD ["node", "server.js"]
```

### 3. Zeaburé…ç½®æ–‡ä»¶

```json
// zbpack.json
{
  "dockerfile": "Dockerfile",
  "port": 3000,
  "health_check": {
    "path": "/health",
    "interval": 30,
    "timeout": 10
  }
}
```

## ğŸš€ Zeaburéƒ¨ç½²é…ç½®

### å¿…éœ€çš„ç¯å¢ƒå˜é‡

```bash
PORT=3000
NODE_ENV=production
MONGO_URI=mongodb+srv://username:password@host/electricity
```

### å¯é€‰é…ç½®

```bash
TZ=Asia/Shanghai
LOG_LEVEL=info
```

### å…³é—­è‡ªåŠ¨ä¼‘çœ ï¼ˆæ¨èï¼‰

å¦‚æœéœ€è¦7Ã—24å°æ—¶è¿è¡Œï¼š

1. Zeaburæ§åˆ¶å° â†’ é¡¹ç›® â†’ Settings
2. æ‰¾åˆ° "Auto Sleep" æˆ– "On-demand Scaling"
3. **å…³é—­ï¼ˆDisableï¼‰**æ­¤é€‰é¡¹

è¿™æ ·Podä¼šæŒç»­è¿è¡Œï¼Œä¸ä¼šè¢«è‡ªåŠ¨ä¼‘çœ ã€‚

## ğŸ“‹ éƒ¨ç½²éªŒè¯æ¸…å•

### æ­¥éª¤1: æ£€æŸ¥æ„å»ºæ—¥å¿—

```
Zeaburæ§åˆ¶å° â†’ Deployments â†’ æŸ¥çœ‹æœ€æ–°éƒ¨ç½²
```

âœ… åº”è¯¥çœ‹åˆ°ï¼š
- "Successfully built"
- "Successfully tagged"
- "Pushing to registry"

### æ­¥éª¤2: æ£€æŸ¥è¿è¡Œæ—¥å¿—

âœ… åº”è¯¥çœ‹åˆ°ï¼š
```
æœåŠ¡å™¨å·²å¯åŠ¨åœ¨ç«¯å£ 3000
å¥åº·æ£€æŸ¥ç«¯ç‚¹: http://localhost:3000/health
ç¯å¢ƒ: production
```

### æ­¥éª¤3: æµ‹è¯•å¥åº·æ£€æŸ¥

```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥ç«¯ç‚¹
curl https://your-app.zeabur.app/health

# é¢„æœŸå“åº”
{
  "status": "ok",
  "timestamp": "2024-...",
  "uptime": 123.456,
  "mongodb": "connected"
}

# æµ‹è¯•pingç«¯ç‚¹
curl https://your-app.zeabur.app/ping
# é¢„æœŸå“åº”: pong
```

### æ­¥éª¤4: è®¿é—®åº”ç”¨

```
https://your-app.zeabur.app
```

- é¦–æ¬¡è®¿é—®ç­‰å¾…10-30ç§’ï¼ˆå®¹å™¨å†·å¯åŠ¨ï¼‰
- çœ‹åˆ°ç”µé‡ç›‘æ§ç•Œé¢å³æˆåŠŸ

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜A: ä»ç„¶æ˜¾ç¤ºNotTriggerScaleUp

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **æ£€æŸ¥Dockerfileæ˜¯å¦è¢«è¯†åˆ«**
   ```bash
   # æŸ¥çœ‹æ„å»ºæ—¥å¿—æ˜¯å¦æœ‰ "Building with Dockerfile"
   ```

2. **æ‰‹åŠ¨é‡æ–°éƒ¨ç½²**
   - Zeaburæ§åˆ¶å° â†’ Redeploy
   - ç¡®ä¿ä½¿ç”¨æœ€æ–°ä»£ç 

3. **éªŒè¯ç«¯å£é…ç½®**
   - ç¯å¢ƒå˜é‡ `PORT=3000` å·²è®¾ç½®
   - zbpack.json ä¸­ `"port": 3000` å·²é…ç½®

### é—®é¢˜B: å®¹å™¨å¯åŠ¨åç«‹å³é€€å‡º

**æ£€æŸ¥æ—¥å¿—ä¸­æ˜¯å¦æœ‰**ï¼š
```
Error: Cannot find module ...
MONGO_URI is undefined
EADDRINUSE: address already in use
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®ä¿æ‰€æœ‰ä¾èµ–å·²å®‰è£…
- æ£€æŸ¥MONGO_URIç¯å¢ƒå˜é‡
- ç¡®è®¤ç«¯å£æœªè¢«å ç”¨

### é—®é¢˜C: å¥åº·æ£€æŸ¥å¤±è´¥

**æµ‹è¯•æœ¬åœ°å¥åº·æ£€æŸ¥**ï¼š
```bash
npm run diagnose
```

**ç¡®è®¤**ï¼š
- `/health` ç«¯ç‚¹è¿”å›200çŠ¶æ€
- `/ping` ç«¯ç‚¹è¿”å› "pong"
- å¯åŠ¨æ—¶é—´ < 40ç§’

## ğŸ¯ å…³é”®é…ç½®å¯¹æ¯”

| é…ç½®é¡¹ | âŒ é”™è¯¯ | âœ… æ­£ç¡® |
|--------|---------|---------|
| ç›‘å¬åœ°å€ | `localhost` | `0.0.0.0` |
| ç«¯å£æš´éœ² | æ— EXPOSE | `EXPOSE 3000` |
| å¥åº·æ£€æŸ¥ | æ— é…ç½® | `/health` + `/ping` |
| å¯åŠ¨å‘½ä»¤ | ä¸æ˜ç¡® | `CMD ["node", "server.js"]` |
| å®¹å™¨é…ç½® | æ— Dockerfile | å®Œæ•´Dockerfile |

## ğŸ’¡ æœ€ä½³å®è·µå»ºè®®

### 1. ä½¿ç”¨Dockerfileéƒ¨ç½²
- âœ… æ˜ç¡®çš„æ„å»ºæ­¥éª¤
- âœ… ç«¯å£å’Œå¥åº·æ£€æŸ¥é…ç½®
- âœ… ç¯å¢ƒå˜é‡é»˜è®¤å€¼

### 2. é…ç½®å¤šä¸ªå¥åº·æ£€æŸ¥ç«¯ç‚¹
```javascript
app.get('/health', ...)  // è¯¦ç»†çŠ¶æ€
app.get('/ping', ...)    // ç®€å•æ¢é’ˆ
app.get('/ready', ...)   // å°±ç»ªæ£€æŸ¥ï¼ˆå¯é€‰ï¼‰
```

### 3. ä¼˜åŒ–å¯åŠ¨æ—¶é—´
- å¼‚æ­¥è¿æ¥MongoDBï¼ˆä¸é˜»å¡å¯åŠ¨ï¼‰
- è®¾ç½®åˆç†çš„å¯åŠ¨è¶…æ—¶ï¼ˆ40ç§’ï¼‰
- ä½¿ç”¨å¥åº·æ£€æŸ¥çš„ `start-period` å‚æ•°

### 4. ç›‘æ§å’Œæ—¥å¿—
```javascript
logger.info('æœåŠ¡å™¨å·²å¯åŠ¨');
logger.info('å¥åº·æ£€æŸ¥ç«¯ç‚¹å¯ç”¨');
logger.info(`ç¯å¢ƒ: ${process.env.NODE_ENV}`);
```

## ğŸ“Š æˆåŠŸæ ‡å¿—

éƒ¨ç½²æˆåŠŸåï¼Œä½ åº”è¯¥çœ‹åˆ°ï¼š

1. âœ… Zeaburæ˜¾ç¤º "Running" çŠ¶æ€
2. âœ… æ—¥å¿—ä¸­æœ‰ "æœåŠ¡å™¨å·²å¯åŠ¨" æ¶ˆæ¯
3. âœ… `/health` è¿”å› `{"status":"ok"}`
4. âœ… åŸŸåå¯ä»¥æ­£å¸¸è®¿é—®
5. âœ… æ²¡æœ‰ NotTriggerScaleUp é”™è¯¯

## ğŸ†˜ ä»ç„¶å¤±è´¥ï¼Ÿ

å¦‚æœä»¥ä¸Šæ–¹æ¡ˆéƒ½å°è¯•åä»ç„¶å¤±è´¥ï¼Œè¯·æä¾›ï¼š

1. **Zeaburæ„å»ºæ—¥å¿—**ï¼ˆæœ€å50è¡Œï¼‰
2. **Zeaburè¿è¡Œæ—¥å¿—**ï¼ˆæœ€å50è¡Œï¼‰
3. **ç¯å¢ƒå˜é‡æˆªå›¾**ï¼ˆéšè—æ•æ„Ÿä¿¡æ¯ï¼‰

å¯ä»¥ç›´æ¥åœ¨Zeaburç¤¾åŒºæˆ–GitHub Issueä¸­å¯»æ±‚å¸®åŠ©ã€‚

---

## ğŸ“ æ›´æ–°æ—¥å¿—

- **2024-10-14**: æ·»åŠ Dockerfileå’Œå®Œæ•´å¥åº·æ£€æŸ¥é…ç½®
- **2024-10-14**: ä¿®å¤ç›‘å¬åœ°å€ä¸º 0.0.0.0
- **2024-10-14**: æ·»åŠ  /ping ç«¯ç‚¹ç”¨äºç®€å•æ¢é’ˆ
- **2024-10-14**: ä¼˜åŒ–zbpack.jsoné…ç½®

